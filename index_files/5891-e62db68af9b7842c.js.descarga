"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5891],{57007:function(e,n,t){t.d(n,{Z:function(){return s}});var o=t(47568),r=t(97582),i=t(62327),a=t(88767),u={getDocuments:function(e){return"/dbo/documents_digitization/get_documents/?p_json_params=".concat(e)},uploadDocument:"/dbo/documents_digitization/upload_document_file/",getDownloadFileDigitization:function(e){var n=e.p_json_params;return"dbo/documents_digitization/get_document_file_digitization/?p_json_params=".concat(void 0===n?null:n)},getTemporaryDocument:function(e){var n=e.p_process_id,t=void 0===n?"":n,o=e.p_process,r=void 0===o?"":o,i=e.p_core_system_transac_table,a=void 0===i?"":i,u=e.p_document_id,s=void 0===u?null:u;return"/dbo/documents_digitization/get_temporary_document/?p_process_id=".concat(t,"&p_process=").concat(r,"&p_core_system_transac_table=").concat(a,"&p_document_id=").concat(s)},setTemporaryDocument:"/dbo/documents_digitization/set_temporary_document/",getTemporaryDocumentBlob:function(e){var n=e.p_document_id;return"dbo/documents_digitization/get_temporary_document_blob/?p_document_id=".concat(void 0===n?null:n)},deleteTemporaryDocument:"/dbo/documents_digitization/delete_temporary_document/",getDocumentsDownload:function(e){return"/dbo/documents_digitization/get_documents_download/?p_json_params=".concat(e)},uploadDocumentWorflow:"/dbo/documents_digitization/upload_document_workflow/",setModificarStatus:"dbo/documents_digitization/set_modificar_status/"};function s(){var e=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.get(u.getDocuments(e))];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),n=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.post(u.uploadDocument,e)];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),t=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.get(u.getDownloadFileDigitization(e))];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),s=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.get(u.getTemporaryDocument(e))];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),c=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.post(u.setTemporaryDocument,e)];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.get(u.getTemporaryDocumentBlob(e))];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),d=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.post(u.deleteTemporaryDocument,e)];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.get(u.getDocumentsDownload(e))];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.post(u.uploadDocumentWorflow,e)];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.Z)((function(e){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.Z.post(u.setModificarStatus,e)];case 1:return[2,n.sent().data]}}))}));return function(n){return e.apply(this,arguments)}}();return{useGetDocuments:function(n){return(0,a.useQuery)(["getDocuments",n],(function(){return e(n)}),{enabled:null!==JSON.parse(n).p_insurance_broker_code&&null!==JSON.parse(n).p_mes})},useUploadFile:function(){return(0,a.useMutation)(n)},useGetDownloadFileDigitization:function(e){return(0,a.useQuery)(["get_document_file_digitization",e],(function(){return t(e)}),{enabled:void 0!==(null===e||void 0===e?void 0:e.p_json_params)})},useGetTemporaryDocument:function(e){return(0,a.useQuery)(["get_temporary_document",e],(function(){return s(e)}),{enabled:void 0!==(null===e||void 0===e?void 0:e.p_process_id)})},useSetTemporaryDocument:function(){return(0,a.useMutation)(c)},useGetTemporaryDocumentBlob:function(e){return(0,a.useQuery)(["get_temporary_document_blob",e],(function(){return l(e)}),{enabled:void 0!==(null===e||void 0===e?void 0:e.p_document_id)})},useDeleteTemporaryDocument:function(){return(0,a.useMutation)(d)},useGetDocumentsDownload:function(e){return(0,a.useQuery)(["getDocumentsDownload"],(function(){return _(e)}),{enabled:!1})},useUploadDocumentWorflow:function(){return(0,a.useMutation)(p)},useModificarStatus:function(){return(0,a.useMutation)(m)}}}},65891:function(e,n,t){t.d(n,{Z:function(){return A}});var o=t(47568),r=t(26042),i=t(69396),a=t(828),u=t(97582),s=t(85893),c=t(45697),l=t.n(c),d=t(67294),_=t(88767),p=t(90948),m=t(15861),f=t(34386),g=t(93946),h=t(80822),v=t(98456),y=t(51233),b=t(11057),x=t(86501),D=t(11163),E=t(57007),S=t(10030),w=t(72007),T=t(93725),Z=t(97177),j=t(87784),C=t(3584),O=t(31812),N=t(86886),R=t(87536),I=(0,p.ZP)("div")((function(){return{overflow:"hidden","& input":{display:"block",height:"100%",left:"0",opacity:"0 !important",position:"absolute",width:"100%"}}}));function M(e){var n=e.workflowId,t=e.taskId,r=e.refresh,i=e.generic,a=(0,d.useState)(),c=a[0],l=a[1],_=(0,(0,E.Z)().useUploadDocumentWorflow)(),p=_.mutate,h=_.isLoading,v=(0,d.useState)((0,S.fp)()),b=v[0],D=(v[1],(0,R.cI)({mode:"onSubmit",defaultValues:{p_document_name:"",internal_document:!0}})),T=D.handleSubmit,Z=D.reset,M=D.formState.isSubmitting,P=function(){var e=(0,o.Z)((function(e){var o,i;return(0,u.__generator)(this,(function(a){return c?((o=new FormData).append("p_lob_file_content",c),i={other_particular_info:e.p_document_name,file_extension:c.name.substring(c.name.lastIndexOf(".")+1),document_content_type:c.type,p_workflow_id:n,p_task_id:t,internal_document:"corporate"===b&&e.internal_document?"S":"N"},o.append("p_json_params",JSON.stringify(i)),p(o,{onSuccess:function(){Z({p_document_name:"",internal_document:!0}),l(),r(),x.ZP.success("Documento cargado exitosamente!")},onError:function(e){x.ZP.error((0,j.J4)(e.response.data))}})):x.ZP.error("Debe adjuntar el documento"),[2]}))}));return function(n){return e.apply(this,arguments)}}();function k(){return(k=(0,o.Z)((function(e){var n;return(0,u.__generator)(this,(function(t){n=e.target.files[0].size/1024/1024;try{if(!0!==["application/pdf","image/jpeg","image/png"].includes(e.target.files[0].type))throw"El documento debe estar en los siguientes formatos: PDF, JPG, PNG";if(n>15)throw x.ZP.error("El documento pesa m\xe1s de 15MB (".concat(n,")")),"El documento pesa m\xe1s de 15MB (".concat(n,")");l(e.target.files[0])}catch(o){console.error(o.statusText)}return[2]}))}))).apply(this,arguments)}return(0,s.jsxs)(s.Fragment,{children:[h&&(0,s.jsx)(w.a_,{disableBg:!0}),!h&&(0,s.jsx)(y.Z,{justifyContent:"left",alignItems:"left",py:2,mt:3,children:(0,s.jsxs)(w.RV,{methods:D,onSubmit:T(P),children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,sm:12,md:12,mb:2,children:(0,s.jsx)(m.Z,{variant:"body1",textAlign:"left",children:(0,s.jsx)("strong",{children:"Documentos Adicionales"})})}),(0,s.jsxs)(y.Z,{direction:{xs:"column",md:"row"},spacing:2,children:[(0,s.jsx)(N.ZP,{item:!0,xs:"corporate"===b?5:8,children:(0,s.jsx)(C.be,{label:"Nombre del Documento",name:"p_document_name",fullWidth:!0,required:!0})}),"corporate"===b&&(0,s.jsx)(N.ZP,{item:!0,xs:4,children:(0,s.jsx)(C.x3,{name:"internal_document",label:"Documento interno",sx:{ml:2}})}),(0,s.jsx)(N.ZP,{item:!0,xs:3,sx:{textAlign:"right"},children:(0,s.jsxs)(y.Z,{direction:{xs:"column",md:"row"},spacing:2,children:[(0,s.jsx)(f.Z,{title:"Agregar Documento",placement:"right-start",arrow:!0,children:(0,s.jsx)(I,{children:(0,s.jsxs)(g.Z,{"aria-label":"Documentos",color:"primary",children:[(0,s.jsx)(w.Ir,{icon:"ion:attach",width:32,height:32}),(0,s.jsx)("input",{accept:"image/*,.pdf",id:"icon-button-file-aditional",onChange:function(e){return function(e){return k.apply(this,arguments)}(e)},onClick:function(e){return e.target.value=null},type:"file",style:{cursor:"pointer"}})]})})}),(0,s.jsxs)(O.Z,{type:"submit",variant:"contained",loading:M,color:"secondary",disabled:!c,children:[(0,s.jsx)(w.Ir,{icon:"ic:baseline-backup",sx:{mx:1}}),"Subir"]})]})})]}),(0,s.jsxs)(y.Z,{direction:{xs:"column",md:"row"},spacing:2,children:[(0,s.jsx)(N.ZP,{item:!0,xs:8}),(0,s.jsx)(N.ZP,{item:!0,xs:4,children:c&&(0,s.jsxs)(g.Z,{color:"primary",variant:"contained",onClick:function(){return l()},children:[(0,s.jsx)(w.Ir,{icon:"material-symbols:delete"}),c.name]})})]}),!i&&(0,s.jsx)(N.ZP,{item:!0,xs:12,sx:{textAlign:"center",mt:3},children:(0,s.jsxs)(O.Z,{variant:"contained",loading:M,color:"secondary",children:[(0,s.jsx)(w.Ir,{icon:"material-symbols:save",sx:{mx:1}}),"Finalizar envio de documentos"]})})]})})]})}var P=(0,p.ZP)("div")((function(){return{position:"relative",display:"flex",flexDirection:"row",justifyContent:"center"}})),k=(0,p.ZP)("div")((function(){return{overflow:"hidden","& input":{display:"block",height:"100%",left:"0",opacity:"0 !important",position:"absolute",width:"100%"}}}));function A(e){var n,t,c=e.params,l=e.showButton,p=void 0===l||l,C=e.workflowId,O=e.taskId,N=e.aditional,R=void 0!==N&&N,I=e.generic,A=void 0!==I&&I,U=e.bottonClosed,z=(0,_.useQueryClient)(),F=(0,d.useState)(),Y=F[0],B=F[1],G=(0,d.useState)({}),Q=G[0],q=G[1],J=(0,d.useState)(),L=J[0],W=J[1],V=(0,d.useState)(!1),K=V[0],H=V[1],X=(0,D.useRouter)(),$=function(){H(!K)},ee=(0,E.Z)(),ne=ee.useGetDocuments,te=ee.useUploadFile,oe=(0,ee.useModificarStatus)().mutate,re=ne(JSON.stringify((0,i.Z)((0,r.Z)({},c),{p_expedient_type:R?"WFL":c.p_expedient_type}))),ie=re.data,ae=re.isLoading,ue=re.refetch,se=re.isFetching;console.log(ie),(0,d.useEffect)((function(){var e;if((console.log(U),U)&&((null===ie||void 0===ie||null===(e=ie.p_documents)||void 0===e?void 0:e.length)>0&&ie.p_documents.every((function(e){return"ENT"===e.CORE_SYSTEM_DOCUMENT_STS})))){console.log("paso por aqui");var n=ie.p_documents[0].CORE_SYSTEM_TRANSACTION_ID,t=(0,a.Z)(n.split("_"),1)[0];console.log(t),oe({p_idepol:t},{onSuccess:function(){x.ZP.success("Poliza con recaudos completados!")},onError:function(e){x.ZP.error((0,j.J4)(e.response.data))}})}}),[null===ie||void 0===ie?void 0:ie.p_documents]);var ce=te(),le=ce.mutate,de=ce.isLoading,_e=function(){var e=(0,o.Z)((function(e){return(0,u.__generator)(this,(function(n){return z.invalidateQueries("get_document_file_digitization"),B({core_system_document_id:e.CORE_SYSTEM_DOCUMENT_ID,core_system_transaction_id:e.CORE_SYSTEM_TRANSACTION_ID,core_system_transaction_table:e.CORE_SYSTEM_TRANSACTION_TABLE,core_unique_doc_id:e.CORE_UNIQUE_DOC_ID}),q({documentName:e.OTHER_PARTICULAR_INFO,contentType:e.DOCUMENT_CONTENT_TYPE}),$(),[2]}))}));return function(n){return e.apply(this,arguments)}}();function pe(e){return me.apply(this,arguments)}function me(){return me=(0,o.Z)((function(e){var n,t=arguments;return(0,u.__generator)(this,(function(o){return n=t.length>1&&void 0!==t[1]?t[1]:.7,[2,new Promise((function(t,o){var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e=document.createElement("canvas"),o=e.getContext("2d");e.width=.7*r.width,e.height=.7*r.height,o.drawImage(r,0,0,e.width,e.height),e.toBlob((function(e){t(e)}),"image/jpeg",n)},r.onerror=o},r.onerror=o}))]}))})),me.apply(this,arguments)}function fe(){return fe=(0,o.Z)((function(e,n){var t,o,r,i,a,s,c,l,d,_,p;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:e.preventDefault(),t=n.row,u.label=1;case 1:if(u.trys.push([1,4,,5]),i=e.target.files[0],!["application/pdf","image/jpeg","image/png"].includes(i.type))throw"El documento debe estar en los siguientes formatos: PDF, JPG, PNG";return a=i,["image/jpeg","image/png"].includes(i.type)?[4,pe(i)]:[3,3];case 2:a=u.sent(),u.label=3;case 3:return W(t.original.CORE_SYSTEM_DOCUMENT_ID),(s=new FormData).append("p_lob_file_content",a),_={core_system_document_id:t.original.CORE_SYSTEM_DOCUMENT_ID,core_system_transaction_id:t.original.CORE_SYSTEM_TRANSACTION_ID.toString(),core_system_transaction_table:t.original.CORE_SYSTEM_TRANSACTION_TABLE,core_system_person_ident:null!==(c=t.original.CORE_SYSTEM_PERSON_IDENT)&&void 0!==c?c:"",core_area_transaction_id:t.original.CORE_AREA_TRANSACTION_ID,core_group_requirement_id:t.original.CORE_GROUP_REQUIREMENT_ID,other_particular_info:t.original.CORE_SYSTEM_DOCUMENT_DESC,file_extension:i.name.substring(i.name.lastIndexOf(".")+1),document_content_type:i.type,p_workflow_id:C,p_task_id:O,core_unique_doc_id:null!==(l=null===(o=t.original)||void 0===o?void 0:o.CORE_UNIQUE_DOC_ID)&&void 0!==l?l:null,document_workflow_id:null!==(d=null===(r=t.original)||void 0===r?void 0:r.DOCUMENT_WORKFLOW_ID)&&void 0!==d?d:null},s.append("p_json_params",JSON.stringify(_)),le(s,{onSuccess:function(){ue(),W(null),x.ZP.success("Documento cargado exitosamente!")},onError:function(e){x.ZP.error((0,j.J4)(e.response.data)),W(null)}}),[3,5];case 4:return p=u.sent(),x.ZP.error(p),[3,5];case 5:return[2]}}))})),fe.apply(this,arguments)}var ge;return(0,s.jsxs)(s.Fragment,{children:[(ae||se)&&(0,s.jsx)(w.a_,{disableBg:!0}),!ae&&!se&&(0,s.jsx)(T.wY,{data:(null===ie||void 0===ie?void 0:ie.p_documents)||[],columns:[{header:"Recaudos",accessorKey:"DESCREQ",cell:function(e){return(0,s.jsx)(m.Z,{variant:"body2",textAlign:"left",children:e.row.original.CORE_SYSTEM_DOCUMENT_DESC})}},{header:"Observaciones",accessorKey:"OBSERVATION",cell:function(e){return(0,s.jsx)(m.Z,{variant:"body2",textAlign:"left",children:null!==(ge=e.row.original.OBSERVATION)&&void 0!==ge?ge:""})}},{header:"Estatus",accessorKey:"STSREQ",cell:function(e){return(0,s.jsx)(w.__,{color:"ENT"===e.row.original.CORE_SYSTEM_DOCUMENT_STS?"success":"error",children:"ENT"===e.row.original.CORE_SYSTEM_DOCUMENT_STS?"Entregado":"Pendiente"})}},{header:"Acciones",align:"center",cell:function(e){return(0,s.jsx)(P,{children:"PEN"===e.row.original.CORE_SYSTEM_DOCUMENT_STS?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{title:"Adjuntar",placement:"right-start",arrow:!0,children:(0,s.jsx)(k,{children:(0,s.jsxs)(g.Z,{"aria-label":"Documentos",color:"primary",children:[(0,s.jsx)(w.Ir,{icon:"ic:baseline-backup",width:24,height:24}),(0,s.jsx)("input",{accept:"image/*,.pdf",id:"icon-button-file-".concat(e.row.original.CORE_SYSTEM_DOCUMENT_ID),onChange:function(n){return function(e,n){return fe.apply(this,arguments)}(n,e)},type:"file",style:{cursor:"pointer"}})]})})}),(0,s.jsx)(h.Z,{children:de&&L===e.row.original.CORE_SYSTEM_DOCUMENT_ID&&(0,s.jsx)(v.Z,{color:"secondary"})})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(f.Z,{title:"Ver documento",placement:"right-start",arrow:!0,children:(0,s.jsx)(g.Z,{"aria-label":"Documentos",color:"secondary",onClick:function(){var n;return _e(null===e||void 0===e||null===(n=e.row)||void 0===n?void 0:n.original)},children:(0,s.jsx)(w.Ir,{icon:"charm:search",width:24,height:24})})})})})}}],options:{actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,sorting:!1,pageSize:null===ie||void 0===ie?void 0:ie.p_documents.length}}),R&&(0,s.jsx)(M,{workflowId:C,taskId:O,refresh:function(){ue(),W(null)},generic:A}),p&&(0,s.jsx)(y.Z,{justifyContent:"center",alignItems:"center",py:2,children:(0,s.jsxs)(b.Z,{variant:"contained",color:"neutral",onClick:function(){var e;(null===X||void 0===X||null===(e=X.query)||void 0===e?void 0:e.return)?X.back():X.push((0,S.Ri)())},children:[(null===X||void 0===X||null===(n=X.query)||void 0===n?void 0:n.return)?"Regresar":"Inicio",(0,s.jsx)(w.Ir,{icon:(null===X||void 0===X||null===(t=X.query)||void 0===t?void 0:t.return)?"ant-design:backward-filled":"mdi:home",sx:{mx:1}})]})}),(0,s.jsx)(Z.Z,{handleClose:$,open:K,apiParams:Y,metaParams:Q})]})}A.propTypes={params:l().object.isRequired,showButton:l().bool}},97177:function(e,n,t){t.d(n,{Z:function(){return g}});var o=t(14924),r=t(85893),i=t(72007),a=t(57007),u=t(87784),s=t(90948),c=t(80822),l=t(39043),d=t(45697),_=t.n(d),p=t(67294),m=(0,s.ZP)(c.Z)((function(e){var n=e.theme,t=e.disableColor;return(0,o.Z)({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",backgroundColor:t?"transparent":n.palette.background.paper},n.breakpoints.up("md"),{width:"50%"})})),f=(0,s.ZP)(c.Z)((function(e){return{boxShadow:24,width:"100%",padding:e.theme.spacing(3,2,2)}}));function g(e){var n=e.open,t=e.handleClose,o=e.apiParams,s=e.metaParams,c=(0,p.useState)(),d=c[0],_=c[1],g=(0,a.Z)(),h=g.useGetDownloadFileDigitization,v=g.useGetTemporaryDocumentBlob,y=h({p_json_params:JSON.stringify((null===o||void 0===o?void 0:o.p_document_id)?void 0:o)}),b=y.data,x=y.isLoading,D=v(o),E=D.data,S=D.isLoading;return(0,p.useEffect)((function(){void 0===b&&void 0===E||function(){var e,n,t=(null===(e=null===b||void 0===b?void 0:b.result[0])||void 0===e?void 0:e.document_file)||(null===(n=null===E||void 0===E?void 0:E.result[0])||void 0===n?void 0:n.DOCUMENT),o=(0,u.cF)(t.data,s.contentType);_(o)}()}),[b,E]),(0,r.jsx)(l.Z,{open:n,onClose:t,children:(0,r.jsxs)(m,{disableColor:x||S,children:[(x||S)&&(0,r.jsx)(i.a_,{disableBg:!0}),(!x||S)&&(0,r.jsx)(f,{children:(0,r.jsx)("iframe",{src:d,frameBorder:"0",style:{style:"overflow:hidden;height:100%;width:100%",width:"100%",height:"80vh"}})})]})})}g.propTypes={open:_().bool.isRequired,handleClose:_().func.isRequired,apiParams:_().object,metaParams:_().object}}}]);